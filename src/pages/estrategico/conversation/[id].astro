---
import ConversationChat from '@/process/strategic/dashboard/ConversationChat';
import '@/styles/global.css';
import { config } from '@/config/strategic-config'

export async function getStaticPaths() {
  try {
    const url = `${config.apiUrl}${config.endpoints.conversation.list}`
    console.log('[getStaticPaths] Fetching conversations from:', url)

    const res = await fetch(url, {
      headers: {
        Accept: 'application/json',
      },
    })

    const contentType = res.headers.get('content-type')
    console.log('[getStaticPaths] Content-Type:', contentType)
    console.log('[getStaticPaths] Status:', res.status)

    const fallbackPaths = Array.from({ length: 1000 }, function (_, i) {
      return { params: { id: String(i + 1) } }
    })

    if (!res.ok || !contentType?.includes('application/json')) {
      if (!contentType?.includes('application/json')) {
        const text = await res.text()
        console.error(
          '[getStaticPaths] Response is not JSON:',
          text.substring(0, 500)
        )
      }

      console.warn('[getStaticPaths] Falling back to default conversations')
      return fallbackPaths
    }

    const json = await res.json()
    console.log('[getStaticPaths] Response data:', json)

    const items = Array.isArray(json?.data)
      ? json.data
      : Array.isArray(json)
      ? json
      : []

    if (items.length === 0) {
      console.warn('[getStaticPaths] No conversations found, using defaults')
      return fallbackPaths
    }

    const paths = items.map(function (c: any) {
      return { params: { id: String(c.id) } }
    })

    console.log('[getStaticPaths] Generated paths:', paths)
    return paths
  } catch (error) {
    console.error('[getStaticPaths] Error fetching conversations:', error)

    return Array.from({ length: 1000 }, function (_, i) {
      return { params: { id: String(i + 1) } }
    })
  }
}


const { id } = Astro.params;

const title = "Chat | INCADEV Estratégico";
const description = "Conversación del módulo estratégico";
const robots = ["noindex", "nofollow"];
const keywords = ["INCADEV", "estratégico", "chat", "conversación", "comunicación"];
const url = `https://instituto.cetivirgendelapuerta.com/estrategico/coordination/comunicaciones/${id}`;
const imageOG = "/ISOLOGOTIPO_VERTICAL.svg";
const imagetwt = "/ISOLOGOTIPO_VERTICAL.svg";
---

<!DOCTYPE html>
<html lang="es" class="dark">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>{title}</title>
  <meta name="description" content={description} />
  <meta name="keywords" content={keywords.join(", ")} />
  <meta name="robots" content={robots.join(", ")} />

  <!-- Open Graph -->
  <meta property="og:title" content={title} />
  <meta property="og:description" content={description} />
  <meta property="og:url" content={url} />
  <meta property="og:image" content={imageOG} />
  <meta property="og:type" content="website" />

  <!-- Twitter Card -->
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:title" content={title} />
  <meta name="twitter:description" content={description} />
  <meta name="twitter:image" content={imagetwt} />

  <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
</head>
<body class="min-h-screen bg-background font-sans antialiased">
  <ConversationChat conversationId={id} client:load />
</body>
</html>
