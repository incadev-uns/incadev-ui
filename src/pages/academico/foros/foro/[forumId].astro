---
import DashboardLayout from '@/layouts/DashboardLayout.astro';
import ThreadListPage from '@/process/academic/dasboard/foros/thread-list/ThreadListPage';
import { config } from '@/config/support-config';

// ============================================
// getStaticPaths - Pre-genera páginas estáticas
// ============================================
export async function getStaticPaths() {
  try {
    // Fetch all forums at build time
    const url = `${config.apiUrl}${config.endpoints.forums.list}`;
    console.log("[Build] Fetching forums from:", url);

    const response = await fetch(url);

    if (!response.ok) {
      console.error('[Build] Error fetching forums:', response.statusText);
      return [];
    }

    const data = await response.json();

    // Manejar respuesta paginada o array directo
    const forums = data.data || data;

    console.log(`[Build] Generating ${forums.length} forum pages`);

    // Generate a path for each forum
    return forums.map((forum: any) => ({
      params: { forumId: forum.id.toString() },
      props: {
        forumId: forum.id,
        forumName: forum.name,
      },
    }));
  } catch (error) {
    console.error('[Build] Error in getStaticPaths:', error);
    return [];
  }
}

const robots = ["noindex", "nofollow"];

const { forumId } = Astro.params;

const title = "Foro | Incadev";
const description = "Explora los hilos de discusión en este foro académico.";
const keywords = ["foros Incadev", "comunidad estudiantil", "discusiones académicas", "soporte entre estudiantes"];
const url = `https://instituto.cetivirgendelapuerta.com/academico/foros/foro/${forumId}`;
const imageOG = "/ISOLOGOTIPO_VERTICAL.svg";
const imagetwt = "/ISOLOGOTIPO_VERTICAL.svg";
---

<DashboardLayout {robots} {title} {description} {keywords} {url} {imageOG} {imagetwt}>
	<ThreadListPage forumId={parseInt(forumId || "0")} client:load/>
</DashboardLayout>
